# ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· Parquet Ñ„Ð°Ð¹Ð»Ð¾Ð²

## âœ… Ð§Ñ‚Ð¾ Ð·Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾

### 1. ÐŸÐ¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ðµ Ñ€Ð°ÑÑ…Ð¾Ð´Ñ‹ (consumption_municipality)
- **303,126 Ð·Ð°Ð¿Ð¸ÑÐµÐ¹** Ð±ÐµÐ·Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ñ… Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²
- **ÐŸÐµÑ€Ð¸Ð¾Ð´**: ÑÐ½Ð²Ð°Ñ€ÑŒ 2023 - Ð´ÐµÐºÐ°Ð±Ñ€ÑŒ 2024 (24 Ð¼ÐµÑÑÑ†Ð°)
- **Ð¢ÐµÑ€Ñ€Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹**: 2,190 Ð¼ÑƒÐ½Ð¸Ñ†Ð¸Ð¿Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ð¹
- **ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸**: 6 ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ Ñ‚Ñ€Ð°Ñ‚

#### Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼:

| ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ | Ð—Ð°Ð¿Ð¸ÑÐµÐ¹ | Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ñ€Ð°ÑÑ…Ð¾Ð´ (Ñ€ÑƒÐ±/Ð¼ÐµÑ) |
|-----------|---------|--------------------------|
| Ð’ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ | 50,521 | 28,566.24 |
| ÐŸÑ€Ð¾Ð´Ð¾Ð²Ð¾Ð»ÑŒÑÑ‚Ð²Ð¸Ðµ | 50,521 | 11,987.10 |
| ÐœÐ°Ñ€ÐºÐµÑ‚Ð¿Ð»ÐµÐ¹ÑÑ‹ | 50,521 | 3,873.02 |
| Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚ | 50,521 | 1,700.07 |
| Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ | 50,521 | 1,393.48 |
| ÐžÐ±Ñ‰ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ Ð¿Ð¸Ñ‚Ð°Ð½Ð¸Ðµ | 50,521 | 1,139.20 |

#### ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹:

**ÐŸÑ€Ð¾Ð´Ð¾Ð²Ð¾Ð»ÑŒÑÑ‚Ð²Ð¸Ðµ** - ÐŸÐ¾ÐºÑƒÐ¿ÐºÐ° Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð² Ð¿Ð¸Ñ‚Ð°Ð½Ð¸Ñ Ð´Ð»Ñ Ð´Ð¾Ð¼Ð°ÑˆÐ½ÐµÐ³Ð¾ Ð¿Ñ€Ð¸Ð³Ð¾Ñ‚Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ: ÑÑƒÐ¿ÐµÑ€Ð¼Ð°Ñ€ÐºÐµÑ‚Ñ‹, Ð³Ð¸Ð¿ÐµÑ€Ð¼Ð°Ñ€ÐºÐµÑ‚Ñ‹, Ð¿Ñ€Ð¾Ð´ÑƒÐºÑ‚Ð¾Ð²Ñ‹Ðµ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½Ñ‹, Ñ€Ñ‹Ð½ÐºÐ¸, Ð°Ð»ÐºÐ¾Ð³Ð¾Ð»ÑŒ, Ñ‚Ð°Ð±Ð°Ðº.

**Ð—Ð´Ð¾Ñ€Ð¾Ð²ÑŒÐµ** - Ð›ÐµÐºÐ°Ñ€ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ðµ Ð¿Ñ€ÐµÐ¿Ð°Ñ€Ð°Ñ‚Ñ‹, Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ¸Ðµ Ð¸Ð·Ð´ÐµÐ»Ð¸Ñ, ÑƒÑÐ»ÑƒÐ³Ð¸ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸, Ð»ÐµÑ‡ÐµÐ½Ð¸Ñ Ð¸ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ð°ÐºÑ‚Ð¸ÐºÐ¸ Ð·Ð°Ð±Ð¾Ð»ÐµÐ²Ð°Ð½Ð¸Ð¹.

**ÐžÐ±Ñ‰ÐµÑÑ‚Ð²ÐµÐ½Ð½Ð¾Ðµ Ð¿Ð¸Ñ‚Ð°Ð½Ð¸Ðµ** - Ð ÐµÑÑ‚Ð¾Ñ€Ð°Ð½Ñ‹, ÐºÐ°Ñ„Ðµ, Ð±Ð°Ñ€Ñ‹, Ñ„Ð°ÑÑ‚Ñ„ÑƒÐ´, ÑÑ‚Ð¾Ð»Ð¾Ð²Ñ‹Ðµ, Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ° Ð³Ð¾Ñ‚Ð¾Ð²Ð¾Ð¹ ÐµÐ´Ñ‹, ÐºÐµÐ¹Ñ‚ÐµÑ€Ð¸Ð½Ð³.

**Ð¢Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚** - Ð“Ð¾Ñ€Ð¾Ð´ÑÐºÐ¾Ð¹/Ð¿Ñ€Ð¸Ð³Ð¾Ñ€Ð¾Ð´Ð½Ñ‹Ð¹ Ñ‚Ñ€Ð°Ð½ÑÐ¿Ð¾Ñ€Ñ‚, Ñ‚Ð°ÐºÑÐ¸, ÐºÐ°Ñ€ÑˆÐµÑ€Ð¸Ð½Ð³, Ñ‚Ð¾Ð¿Ð»Ð¸Ð²Ð¾, Ñ€ÐµÐ¼Ð¾Ð½Ñ‚ Ð°Ð²Ñ‚Ð¾, Ð¿ÐµÑ€ÐµÐ²Ð¾Ð·ÐºÐ° (Ð±ÐµÐ· Ð°Ð²Ð¸Ð° Ð¸ Ð¶/Ð´).

**ÐœÐ°Ñ€ÐºÐµÑ‚Ð¿Ð»ÐµÐ¹ÑÑ‹** - ÐžÐ½Ð»Ð°Ð¹Ð½-Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñ‹ Ñ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²Ð¾Ð¼ Ð¿Ñ€Ð¾Ð´Ð°Ð²Ñ†Ð¾Ð²: Ð¾Ð´ÐµÐ¶Ð´Ð°, ÑÐ»ÐµÐºÑ‚Ñ€Ð¾Ð½Ð¸ÐºÐ°, Ð±Ñ‹Ñ‚Ð¾Ð²Ð°Ñ Ñ‚ÐµÑ…Ð½Ð¸ÐºÐ°, ÐºÐ½Ð¸Ð³Ð¸ Ð¸ Ð´Ñ€.

**Ð’ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸** - Ð’ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð²ÑÐµ Ð²Ñ‹ÑˆÐµÐ¿ÐµÑ€ÐµÑ‡Ð¸ÑÐ»ÐµÐ½Ð½Ñ‹Ðµ Ð¸ Ð¸Ð½Ñ‹Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ñ… Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð².

---

### 2. Ð˜Ð½Ð´ÐµÐºÑ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ Ñ€Ñ‹Ð½ÐºÐ¾Ð² (market_access_municipality)
- **2,571 Ñ‚ÐµÑ€Ñ€Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹** Ñ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸
- **Ð“Ð¾Ð´**: 2024
- **Ð”Ð¸Ð°Ð¿Ð°Ð·Ð¾Ð½ Ð¸Ð½Ð´ÐµÐºÑÐ°**: 110.30 - 1,000.00
- **ÐžÑ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚**: 22 ÐœÐž Ð±ÐµÐ· Ð¿Ð¾ÑÑ‚Ð¾ÑÐ½Ð½Ð¾Ð³Ð¾ Ð°Ð²Ñ‚Ð¾Ð´Ð¾Ñ€Ð¾Ð¶Ð½Ð¾Ð³Ð¾ Ð¸Ð»Ð¸ Ð¿Ð°Ñ€Ð¾Ð¼Ð½Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ

#### Ð§Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð¸Ð½Ð´ÐµÐºÑ:
ÐžÑ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¿Ð¾Ñ‚ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ð±ÑŠÑ‘Ð¼ Ð²Ð½ÐµÑˆÐ½ÐµÐ³Ð¾ Ñ€Ñ‹Ð½ÐºÐ°, Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¹ Ð² Ð¼ÑƒÐ½Ð¸Ñ†Ð¸Ð¿Ð°Ð»ÑŒÐ½Ð¾Ð¼ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ð¸. Ð‘Ð¾Ð»ÐµÐµ Ð²Ñ‹ÑÐ¾ÐºÐ¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ = Ð±Ð¾Ð»ÐµÐµ Ð²Ñ‹Ð³Ð¾Ð´Ð½Ð¾Ðµ ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸ÐºÐ¾-Ð³ÐµÐ¾Ð³Ñ€Ð°Ñ„Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð¸ Ð±Ð»Ð¸Ð·Ð¾ÑÑ‚ÑŒ Ðº ÐºÑ€ÑƒÐ¿Ð½Ñ‹Ð¼ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ð¼ Ñ€Ñ‹Ð½ÐºÐ°Ð¼.

**Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð° Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð°:**
MA = Î£ (ÐÐ°ÑÐµÐ»ÐµÐ½Ð¸Ðµ_ÐœÐž_d / Ð Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ðµ_Ð´Ð¾_ÐœÐž_d)
Ð—Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð½Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ Ð¾Ñ‚ 0 Ð´Ð¾ 1,000.

---

## ðŸ“Š Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ† Ð² Ð‘Ð”

### consumption_municipality
```sql
CREATE TABLE sberindex.consumption_municipality (
    consumption_id BIGSERIAL PRIMARY KEY,
    territory_id VARCHAR(50) NOT NULL,        -- ÐšÐ¾Ð´ Ñ‚ÐµÑ€Ñ€Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸ (ÐœÐž)
    date DATE NOT NULL,                       -- Ð“Ð¾Ð´ Ð¸ Ð¼ÐµÑÑÑ†
    category VARCHAR(255) NOT NULL,           -- ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²
    consumption NUMERIC(15, 2),               -- Ð¡Ñ€ÐµÐ´Ð½Ð¸Ðµ Ñ€Ð°ÑÑ…Ð¾Ð´Ñ‹ (Ñ€ÑƒÐ±)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(territory_id, date, category)
);
```

**Ð˜Ð½Ð´ÐµÐºÑÑ‹:**
- `idx_consumption_territory` - Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ Ð¿Ð¾Ð¸ÑÐº Ð¿Ð¾ Ñ‚ÐµÑ€Ñ€Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸
- `idx_consumption_date` - Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ
- `idx_consumption_category` - Ð³Ñ€ÑƒÐ¿Ð¿Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼
- `idx_consumption_analytics` - ÐºÐ¾Ð¼Ð¿Ð¾Ð·Ð¸Ñ‚Ð½Ñ‹Ð¹ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸

### market_access_municipality
```sql
CREATE TABLE sberindex.market_access_municipality (
    market_access_id SERIAL PRIMARY KEY,
    territory_id VARCHAR(50) NOT NULL UNIQUE, -- ÐšÐ¾Ð´ Ñ‚ÐµÑ€Ñ€Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸
    market_access NUMERIC(10, 4),             -- Ð˜Ð½Ð´ÐµÐºÑ 0-1000
    year INTEGER DEFAULT 2024,                -- Ð“Ð¾Ð´ Ñ€Ð°ÑÑ‡Ñ‘Ñ‚Ð°
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**Ð˜Ð½Ð´ÐµÐºÑÑ‹:**
- `idx_market_access_territory` - Ð¿Ð¾Ð¸ÑÐº Ð¿Ð¾ Ñ‚ÐµÑ€Ñ€Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸
- `idx_market_access_value` - ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¿Ð¾ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸ÑŽ Ð¸Ð½Ð´ÐµÐºÑÐ°
- `idx_market_access_year` - Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð³Ð¾Ð´Ñƒ

---

## ðŸ”— Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°Ð¼Ð¸

### Ð¡Ð²ÑÐ·ÑŒ Ñ‡ÐµÑ€ÐµÐ· territory_id

```sql
-- ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼ POAD Ð¿Ð¾ Ð½Ð°ÑÐµÐ»Ñ‘Ð½Ð½Ñ‹Ð¼ Ð¿ÑƒÐ½ÐºÑ‚Ð°Ð¼ (Ñ‡ÐµÑ€ÐµÐ· ÐžÐšÐ¢ÐœÐž)
SELECT
    c.territory_id,
    c.category,
    c.consumption,
    s.settlement_name,
    r.region_name
FROM sberindex.consumption_municipality c
LEFT JOIN sberindex.dict_settlements s
    ON c.territory_id = s.oktmo_code  -- Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð´Ð¾Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¼Ð°Ð¿Ð¿Ð¸Ð½Ð³Ð°
LEFT JOIN sberindex.dict_regions r
    ON s.region_id = r.region_id;
```

### Ð¡Ð²ÑÐ·ÑŒ market_access + consumption

```sql
-- ÐÐ½Ð°Ð»Ð¸Ð· Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ñ Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ Ñ€Ñ‹Ð½ÐºÐ¾Ð²
SELECT
    m.market_access,
    CASE
        WHEN m.market_access >= 800 THEN 'Ð’Ñ‹ÑÐ¾ÐºÐ°Ñ'
        WHEN m.market_access >= 500 THEN 'Ð¡Ñ€ÐµÐ´Ð½ÑÑ'
        ELSE 'ÐÐ¸Ð·ÐºÐ°Ñ'
    END as accessibility_level,
    c.category,
    AVG(c.consumption) as avg_consumption
FROM sberindex.market_access_municipality m
JOIN sberindex.consumption_municipality c
    ON m.territory_id = c.territory_id
WHERE c.date >= '2024-01-01'
GROUP BY m.market_access, 2, c.category;
```

---

## ðŸ“ˆ ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²

### 1. Ð”Ð¸Ð½Ð°Ð¼Ð¸ÐºÐ° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ñ Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼

```sql
SELECT
    DATE_TRUNC('month', date) as month,
    category,
    AVG(consumption) as avg_consumption,
    COUNT(DISTINCT territory_id) as territories
FROM sberindex.consumption_municipality
GROUP BY 1, 2
ORDER BY 1, 2;
```

### 2. Ð¢Ð¾Ð¿-20 Ñ‚ÐµÑ€Ñ€Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Ð¿Ð¾ Ñ€Ð°ÑÑ…Ð¾Ð´Ð°Ð¼ Ð² ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸

```sql
SELECT
    territory_id,
    category,
    AVG(consumption) as avg_monthly_consumption
FROM sberindex.consumption_municipality
WHERE category = 'ÐŸÑ€Ð¾Ð´Ð¾Ð²Ð¾Ð»ÑŒÑÑ‚Ð²Ð¸Ðµ'
  AND date >= '2024-01-01'
GROUP BY territory_id, category
ORDER BY avg_monthly_consumption DESC
LIMIT 20;
```

### 3. ÐšÐ¾Ñ€Ñ€ÐµÐ»ÑÑ†Ð¸Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ Ñ€Ñ‹Ð½ÐºÐ¾Ð² Ð¸ Ñ€Ð°ÑÑ…Ð¾Ð´Ð¾Ð²

```sql
WITH consumption_avg AS (
    SELECT
        territory_id,
        AVG(consumption) FILTER (WHERE category = 'Ð’ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸') as avg_total_consumption
    FROM sberindex.consumption_municipality
    WHERE date >= '2024-01-01'
    GROUP BY territory_id
)
SELECT
    CASE
        WHEN m.market_access >= 800 THEN '>= 800'
        WHEN m.market_access >= 600 THEN '600-800'
        WHEN m.market_access >= 400 THEN '400-600'
        WHEN m.market_access >= 200 THEN '200-400'
        ELSE '< 200'
    END as market_access_range,
    COUNT(*) as territories_count,
    AVG(c.avg_total_consumption) as avg_consumption,
    MIN(c.avg_total_consumption) as min_consumption,
    MAX(c.avg_total_consumption) as max_consumption
FROM sberindex.market_access_municipality m
JOIN consumption_avg c ON m.territory_id = c.territory_id
GROUP BY 1
ORDER BY MIN(m.market_access);
```

### 4. Ð¡ÐµÐ·Ð¾Ð½Ð½Ð¾ÑÑ‚ÑŒ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼

```sql
SELECT
    EXTRACT(MONTH FROM date) as month,
    category,
    AVG(consumption) as avg_consumption
FROM sberindex.consumption_municipality
GROUP BY 1, 2
ORDER BY 1, 2;
```

### 5. Ð Ð¾ÑÑ‚/Ð¿Ð°Ð´ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ñ Ð³Ð¾Ð´ Ðº Ð³Ð¾Ð´Ñƒ

```sql
SELECT
    territory_id,
    category,
    AVG(CASE WHEN date >= '2024-01-01' THEN consumption END) as consumption_2024,
    AVG(CASE WHEN date < '2024-01-01' THEN consumption END) as consumption_2023,
    (AVG(CASE WHEN date >= '2024-01-01' THEN consumption END) -
     AVG(CASE WHEN date < '2024-01-01' THEN consumption END)) /
     NULLIF(AVG(CASE WHEN date < '2024-01-01' THEN consumption END), 0) * 100 as growth_pct
FROM sberindex.consumption_municipality
WHERE category = 'Ð’ÑÐµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸'
GROUP BY territory_id, category
HAVING AVG(CASE WHEN date < '2024-01-01' THEN consumption END) IS NOT NULL
ORDER BY growth_pct DESC NULLS LAST
LIMIT 20;
```

---

## ðŸ“ Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº Ð¸ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

**Ð˜ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº**: Ð¡Ð±ÐµÑ€Ð˜Ð½Ð´ÐµÐºÑ (Ð›Ð°Ð±Ð¾Ñ€Ð°Ñ‚Ð¾Ñ€Ð¸Ñ)
**Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ**: CC BY-SA 4.0 (Creative Commons Attribution-ShareAlike 4.0 International)
**URL**: https://sberindex.ru/ru/research/data-sense-opisanie-nabora-dannikh-khakatona-sberindeksa-po-munitsipalnim-dannim

### Ð¦Ð¸Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:

**RU**: ÐŸÐ¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ðµ Ð±ÐµÐ·Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ Ñ€Ð°ÑÑ…Ð¾Ð´Ñ‹ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð¼ÑƒÐ½Ð¸Ñ†Ð¸Ð¿Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ð¹ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼ Ñ‚Ñ€Ð°Ñ‚. Ð¡Ð±ÐµÑ€Ð˜Ð½Ð´ÐµÐºÑ. Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð¿Ð¾ Ð°Ð´Ñ€ÐµÑÑƒ https://sberindex.ru/ru/research/data-sense-opisanie-nabora-dannikh-khakatona-sberindeksa-po-munitsipalnim-dannim (Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐºÐ°Ñ‡Ð°Ð½Ñ‹ 2025-10-24).

**EN**: Consumer spending at the municipal level. Sberindex. Available at https://sberindex.ru/ru/research/data-sense-opisanie-nabora-dannikh-khakatona-sberindeksa-po-munitsipalnim-dannim (data downloaded on 2025-10-24).

---

## ðŸŽ¯ ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ¸

### Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ñ‹Ðµ Ð¸ÑÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð¸Ñ:

1. **Ð ÐµÐ³Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð¸Ñ** - Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð³Ð¾ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ñ Ð¼ÐµÐ¶Ð´Ñƒ Ñ€ÐµÐ³Ð¸Ð¾Ð½Ð°Ð¼Ð¸
2. **Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ñ‚Ñ€ÐµÐ½Ð´Ñ‹** - Ð’Ñ‹ÑÐ²Ð»ÐµÐ½Ð¸Ðµ ÑÐµÐ·Ð¾Ð½Ð½Ð¾ÑÑ‚Ð¸ Ð¸ Ð´Ð¾Ð»Ð³Ð¾ÑÑ€Ð¾Ñ‡Ð½Ñ‹Ñ… Ñ‚Ñ€ÐµÐ½Ð´Ð¾Ð²
3. **Ð’Ð»Ð¸ÑÐ½Ð¸Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸** - Ð¡Ð²ÑÐ·ÑŒ Ð¼ÐµÐ¶Ð´Ñƒ Ð¸Ð½Ð´ÐµÐºÑÐ¾Ð¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚Ð¸ Ñ€Ñ‹Ð½ÐºÐ¾Ð² Ð¸ ÑƒÑ€Ð¾Ð²Ð½ÐµÐ¼ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ñ
4. **ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·** - Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ñ, Ð¿Ñ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ñ‹ Ñ‚Ñ€Ð°Ñ‚
5. **Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð½ÐµÑ€Ð°Ð²ÐµÐ½ÑÑ‚Ð²Ð¾** - Ð Ð°Ð·Ð±Ñ€Ð¾Ñ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¼ÐµÐ¶Ð´Ñƒ ÐœÐž
6. **ÐŸÑ€Ð¾Ð³Ð½Ð¾Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ** - ÐœÐ¾Ð´ÐµÐ»Ð¸ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·Ð°Ð½Ð¸Ñ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ñ
7. **ÐŸÑ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·** - Ð“ÐµÐ¾Ð³Ñ€Ð°Ñ„Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¿Ð°Ñ‚Ñ‚ÐµÑ€Ð½Ñ‹ (Ð¿Ñ€Ð¸ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ð¸ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚)

---

**Ð”Ð°Ñ‚Ð° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸**: 2025-10-24
**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ**: âœ… Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð¾
